#!/bin/bash
set -eo pipefail

echo "======================================================================================================================"
echo "======================================================================================================================"
echo "== Uninstalling existing tensorflow =="
echo "======================================================================================================================"
echo "======================================================================================================================"
pip uninstall -y tensorflow tensorflow-estimator tf-nightly || true

echo "======================================================================================================================"
echo "======================================================================================================================"
echo "== Installing tensorflow =="
echo "======================================================================================================================"
echo "======================================================================================================================"
pip install -U https://storage.googleapis.com/tensorflow/linux/cpu/tensorflow_cpu-2.4.0-cp38-cp38-manylinux2010_x86_64.whl

echo "======================================================================================================================"
echo "======================================================================================================================"
echo "== Testing gpu availability                                      =="
echo "== This should print list of gpu devices available in the system =="
echo "======================================================================================================================"
echo "======================================================================================================================"
python -c "import tensorflow as tf; print(tf.config.list_physical_devices('GPU'))"

